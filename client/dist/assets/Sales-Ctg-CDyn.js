import{c as S,u as C,r as n,b as v,V as r,j as e,d as m,P as V,e as E,D as $,a as D}from"./index-Bn1b0IaB.js";import{P as y,T as I}from"./trash-2-BZv5b5AW.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=S("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]),R=()=>{const{user:o}=C(),[w,k]=n.useState([]),[l,d]=n.useState([]),[u,h]=n.useState(""),[b,g]=n.useState(""),[i,p]=n.useState(!1);n.useEffect(()=>{j()},[]);const j=async()=>{try{const s=await v.get("/api/products");k(s.data.data||[])}catch(s){console.error("Error loading products:",s),r.error("Error al cargar productos")}},P=s=>{const t=l.findIndex(a=>a.id===s.id);if(t>=0){const a=[...l];a[t].quantity+=1,d(a)}else d([...l,{...s,quantity:1}]);r.success(`${s.name} agregado`)},f=(s,t)=>{if(t<=0){N(s);return}const a=l.map(x=>x.id===s?{...x,quantity:t}:x);d(a)},N=s=>{d(l.filter(t=>t.id!==s)),r.success("Producto eliminado del carrito")},c=()=>l.reduce((s,t)=>s+t.price*t.quantity,0),q=async s=>{if(s.preventDefault(),!o||!o.id){r.error("Usuario no autenticado");return}if(l.length===0){r.error("Debe agregar al menos un producto");return}p(!0);try{const t={user_id:o.id,client:u,products:l.map(a=>({productId:a.id,name:a.name,quantity:a.quantity,price:a.price})),total:c(),notes:b,status:"completed"};await D.post("/api/sales",t);for(const a of l)await v.patch(`/api/products/${a.id}/decrease-stock`,{quantity:a.quantity});r.success("¡Venta registrada exitosamente!"),d([]),h(""),g(""),j()}catch(t){console.error("Error creating sale:",t),r.error("Error al registrar la venta")}finally{p(!1)}};return e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-8 border border-slate-200/50",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-orange-500 to-red-500 rounded-2xl shadow-lg",children:e.jsx(m,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 bg-clip-text text-transparent",children:"Nueva Venta"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Registra una nueva venta en el sistema"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-slate-200/50",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center",children:[e.jsx(V,{className:"h-6 w-6 mr-2 text-emerald-600"}),"Productos Disponibles"]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition-all duration-200",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:s.name}),e.jsx("p",{className:"text-sm text-slate-600",children:s.category}),e.jsxs("div",{className:"flex items-center space-x-4 mt-2",children:[e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:["$",s.price]}),e.jsxs("span",{className:`text-sm px-2 py-1 rounded-full ${s.stock>10?"bg-green-100 text-green-800":s.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:["Stock: ",s.stock]})]})]}),e.jsx("button",{onClick:()=>P(s),disabled:s.stock===0,className:"ml-4 bg-gradient-to-r from-emerald-600 to-teal-600 text-white px-4 py-2 rounded-lg hover:from-emerald-700 hover:to-teal-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(y,{className:"h-4 w-4"})})]},s.id))})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-slate-200/50",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center",children:[e.jsx(m,{className:"h-6 w-6 mr-2 text-orange-600"}),"Carrito de Compras"]}),l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(m,{className:"h-12 w-12 text-slate-300 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-500",children:"No hay productos seleccionados"})]}):e.jsxs("div",{className:"space-y-4",children:[l.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-50 rounded-xl",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600",children:["$",s.price," c/u"]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>f(s.id,s.quantity-1),className:"p-1 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors",children:e.jsx(T,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-8 text-center font-semibold",children:s.quantity}),e.jsx("button",{onClick:()=>f(s.id,s.quantity+1),className:"p-1 bg-slate-200 rounded-lg hover:bg-slate-300 transition-colors",children:e.jsx(y,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>N(s.id),className:"p-1 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors ml-2",children:e.jsx(I,{className:"h-4 w-4"})})]})]},s.id)),e.jsx("div",{className:"border-t border-slate-200 pt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-xl font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-emerald-600",children:["$",c().toFixed(2)]})]})})]})]}),e.jsxs("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl shadow-lg p-6 border border-slate-200/50",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-900 mb-6 flex items-center",children:[e.jsx(E,{className:"h-6 w-6 mr-2 text-blue-600"}),"Información de la Venta"]}),e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Nombre del Cliente"}),e.jsx("input",{type:"text",required:!0,value:u,onChange:s=>h(s.target.value),className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200",placeholder:"Ingresa el nombre del cliente"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Notas Adicionales"}),e.jsx("textarea",{value:b,onChange:s=>g(s.target.value),rows:3,className:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 resize-none",placeholder:"Notas sobre la venta (opcional)"})]}),e.jsxs("div",{className:"bg-slate-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Vendedor:"}),e.jsx("span",{className:"font-semibold text-slate-900",children:o?.name})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-slate-600",children:"Productos:"}),e.jsx("span",{className:"font-semibold text-slate-900",children:l.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-lg font-bold",children:[e.jsx("span",{className:"text-slate-900",children:"Total:"}),e.jsxs("span",{className:"text-emerald-600",children:["$",c().toFixed(2)]})]})]}),e.jsxs("button",{type:"submit",disabled:i||l.length===0,className:"w-full bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-4 px-6 rounded-xl hover:from-emerald-700 hover:to-teal-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed font-semibold text-lg shadow-lg flex items-center justify-center",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-white mr-2"}):e.jsx($,{className:"h-6 w-6 mr-2"}),i?"Procesando Venta...":"Registrar Venta"]})]})]})]})]})]})};export{R as default};
